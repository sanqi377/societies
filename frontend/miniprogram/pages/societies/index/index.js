"use strict";
Object.defineProperty(exports, "__esModule", { value: true });
var _a = require('../../../utils/util'), ajax = _a.ajax, formatMsgTime = _a.formatMsgTime;
var app = getApp();
var list = [];
var count = 0;
var isBottom = false;
Page({
    list: [],
    onShow: function () {
        if (typeof this.getTabBar === 'function' && this.getTabBar()) {
            this.getTabBar().setData({
                selected: 1
            });
        }
        this.getDynamic();
    },
    goPublish: function () {
        wx.navigateTo({
            url: "/pages/societies/publish/index"
        });
    },
    subscribe: function (e) {
        var _this = this;
        var index = e.currentTarget.dataset.index;
        var data = {
            subscribe: app.globalData.uid,
            be_subscribe: e.currentTarget.dataset.be_subscribe,
            update_time: Date.parse(new Date()) / 1000
        };
        app.globalData.subscribe(data).then(function () {
            _this.data.list[index].fans = true;
            _this.setData({
                list: _this.data.list
            });
        });
    },
    goInfo: function (e) {
        wx.navigateTo({
            url: "/pages/user/info/index?uid=" + e.currentTarget.dataset.uid
        });
    },
    cancelSubscribe: function (e) {
        var _this = this;
        var index = e.currentTarget.dataset.index;
        var data = {
            subscribe: app.globalData.uid,
            be_subscribe: e.currentTarget.dataset.be_subscribe,
        };
        app.globalData.unSubscribe({
            data: data,
            success: function () {
                _this.data.list[index].fans = false;
                _this.setData({
                    list: _this.data.list
                });
            }
        });
    },
    getDynamic: function () {
        var _this = this;
        count++;
        if (!isBottom) {
            ajax('Dynamic/getList', { uid: app.globalData.uid, page: count }).then(function (res) {
                wx.stopPullDownRefresh();
                if (res.data.data.length > 0) {
                    for (var key in res.data.data) {
                        res.data.data[key].create_time = formatMsgTime(res.data.data[key].create_time * 1000);
                        list.push(res.data.data[key]);
                    }
                    _this.setData({
                        list: list
                    });
                }
                else {
                    isBottom = true;
                }
            });
        }
    },
    onLoad: function () {
    },
    onReady: function () {
    },
    onHide: function () {
        list = [];
        count = 0;
    },
    onUnload: function () {
    },
    onPullDownRefresh: function () {
        list = [];
        count = 0;
        this.getDynamic();
    },
    onReachBottom: function () {
        this.getDynamic();
    },
    onShareAppMessage: function () {
    }
});
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiaW5kZXguanMiLCJzb3VyY2VSb290IjoiIiwic291cmNlcyI6WyJpbmRleC50cyJdLCJuYW1lcyI6W10sIm1hcHBpbmdzIjoiOztBQUNNLElBQUEsS0FBMEIsT0FBTyxDQUFDLHFCQUFxQixDQUFDLEVBQXRELElBQUksVUFBQSxFQUFFLGFBQWEsbUJBQW1DLENBQUE7QUFDOUQsSUFBTSxHQUFHLEdBQUcsTUFBTSxFQUFFLENBQUE7QUFDcEIsSUFBSSxJQUFJLEdBQVEsRUFBRSxDQUFBO0FBQ2xCLElBQUksS0FBSyxHQUFHLENBQUMsQ0FBQTtBQUNiLElBQUksUUFBUSxHQUFHLEtBQUssQ0FBQTtBQUNwQixJQUFJLENBQUM7SUFDSCxJQUFJLEVBQUUsRUFBRTtJQUVSLE1BQU0sRUFBRTtRQUNOLElBQUksT0FBTyxJQUFJLENBQUMsU0FBUyxLQUFLLFVBQVUsSUFBSSxJQUFJLENBQUMsU0FBUyxFQUFFLEVBQUU7WUFDNUQsSUFBSSxDQUFDLFNBQVMsRUFBRSxDQUFDLE9BQU8sQ0FBQztnQkFDdkIsUUFBUSxFQUFFLENBQUM7YUFDWixDQUFDLENBQUE7U0FDSDtRQUNELElBQUksQ0FBQyxVQUFVLEVBQUUsQ0FBQTtJQUNuQixDQUFDO0lBRUQsU0FBUztRQUNQLEVBQUUsQ0FBQyxVQUFVLENBQUM7WUFDWixHQUFHLEVBQUUsZ0NBQWdDO1NBQ3RDLENBQUMsQ0FBQTtJQUNKLENBQUM7SUFNRCxTQUFTLEVBQVQsVUFBVSxDQUFNO1FBQWhCLGlCQWFDO1FBWkMsSUFBSSxLQUFLLEdBQUcsQ0FBQyxDQUFDLGFBQWEsQ0FBQyxPQUFPLENBQUMsS0FBSyxDQUFBO1FBQ3pDLElBQUksSUFBSSxHQUFHO1lBQ1QsU0FBUyxFQUFFLEdBQUcsQ0FBQyxVQUFVLENBQUMsR0FBRztZQUM3QixZQUFZLEVBQUUsQ0FBQyxDQUFDLGFBQWEsQ0FBQyxPQUFPLENBQUMsWUFBWTtZQUNsRCxXQUFXLEVBQUUsSUFBSSxDQUFDLEtBQUssQ0FBRSxJQUFJLElBQUksRUFBVSxDQUFDLEdBQUcsSUFB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RSxDQUFBO0lBQ25CLENBQUM7SUFLRCxhQUFhO1FBRVgsSUFBSSxDQUFDLFVBQVUsRUFBRSxDQUFBO0lBQ25CLENBQUM7SUFLRCxpQkFBaUI7SUFFakIsQ0FBQztDQUNGLENBQUMsQ0FBQSIsInNvdXJjZXNDb250ZW50IjpbImV4cG9ydCB7IH1cclxuY29uc3QgeyBhamF4LCBmb3JtYXRNc2dUaW1lIH0gPSByZXF1aXJlKCcuLi8uLi8uLi91dGlscy91dGlsJylcclxuY29uc3QgYXBwID0gZ2V0QXBwKClcclxubGV0IGxpc3Q6IGFueSA9IFtdXHJcbmxldCBjb3VudCA9IDBcclxubGV0IGlzQm90dG9tID0gZmFsc2VcclxuUGFnZSh7XHJcbiAgbGlzdDogW10sXHJcblxyXG4gIG9uU2hvdzogZnVuY3Rpb24gKCkge1xyXG4gICAgaWYgKHR5cGVvZiB0aGlzLmdldFRhYkJhciA9PT0gJ2Z1bmN0aW9uJyAmJiB0aGlzLmdldFRhYkJhcigpKSB7XHJcbiAgICAgIHRoaXMuZ2V0VGFiQmFyKCkuc2V0RGF0YSh7XHJcbiAgICAgICAgc2VsZWN0ZWQ6IDFcclxuICAgICAgfSlcclxuICAgIH1cclxuICAgIHRoaXMuZ2V0RHluYW1pYygpXHJcbiAgfSxcclxuXHJcbiAgZ29QdWJsaXNoKCkge1xyXG4gICAgd3gubmF2aWdhdGVUbyh7XHJcbiAgICAgIHVybDogXCIvcGFnZXMvc29jaWV0aWVzL3B1Ymxpc2gvaW5kZXhcIlxyXG4gICAgfSlcclxuICB9LFxyXG5cclxuICAvKipcclxuICAgICAqIOWFs+azqFxyXG4gICAgICogQHBhcmFtIGUgXHJcbiAgICAgKi9cclxuICBzdWJzY3JpYmUoZTogYW55KSB7XHJcbiAgICBsZXQgaW5kZXggPSBlLmN1cnJlbnRUYXJnZXQuZGF0YXNldC5pbmRleFxyXG4gICAgbGV0IGRhdGEgPSB7XHJcbiAgICAgIHN1YnNjcmliZTogYXBwLmdsb2JhbERhdGEudWlkLFxyXG4gICAgICBiZV9zdWJzY3JpYmU6IGUuY3VycmVudFRhcmdldC5kYXRhc2V0LmJlX3N1YnNjcmliZSxcclxuICAgICAgdXBkYXRlX3RpbWU6IERhdGUucGFyc2UoKG5ldyBEYXRlKCkgYXMgYW55KSkgLyAxMDAwXHJcbiAgICB9XHJcbiAgICBhcHAuZ2xvYmFsRGF0YS5zdWJzY3JpYmUoZGF0YSkudGhlbigoKSA9PiB7XHJcbiAgICAgIHRoaXMuZGF0YS5saXN0W2luZGV4XS5mYW5zID0gdHJ1ZVxyXG4gICAgICB0aGlzLnNldERhdGEoe1xyXG4gICAgICAgIGxpc3Q6IHRoaXMuZGF0YS5saXN0XHJcbiAgICAgIH0pXHJcbiAgICB9KVxyXG4gIH0sXHJcblxyXG4gIGdvSW5mbyhlOiBhbnkpIHtcclxuICAgIHd4Lm5hdmlnYXRlVG8oe1xyXG4gICAgICB1cmw6IFwiL3BhZ2VzL3VzZXIvaW5mby9pbmRleD91aWQ9XCIgKyBlLmN1cnJlbnRUYXJnZXQuZGF0YXNldC51aWRcclxuICAgIH0pXHJcbiAgfSxcclxuXHJcbiAgLyoqXHJcbiAgICAgKiDlj5bmtojlhbPms6hcclxuICAgICAqIEBwYXJhbSBlIFxyXG4gICAgICovXHJcbiAgY2FuY2VsU3Vic2NyaWJlKGU6IGFueSkge1xyXG4gICAgbGV0IGluZGV4ID0gZS5jdXJyZW50VGFyZ2V0LmRhdGFzZXQuaW5kZXhcclxuICAgIGxldCBkYXRhID0ge1xyXG4gICAgICBzdWJzY3JpYmU6IGFwcC5nbG9iYWxEYXRhLnVpZCxcclxuICAgICAgYmVfc3Vic2NyaWJlOiBlLmN1cnJlbnRUYXJnZXQuZGF0YXNldC5iZV9zdWJzY3JpYmUsXHJcbiAgICB9XHJcbiAgICBhcHAuZ2xvYmFsRGF0YS51blN1YnNjcmliZSh7XHJcbiAgICAgIGRhdGEsIHN1Y2Nlc3M6ICgpID0+IHtcclxuICAgICAgICB0aGlzLmRhdGEubGlzdFtpbmRleF0uZmFucyA9IGZhbHNlXHJcbiAgICAgICAgdGhpcy5zZXREYXRhKHtcclxuICAgICAgICAgIGxpc3Q6IHRoaXMuZGF0YS5saXN0XHJcbiAgICAgICAgfSlcclxuICAgICAgfVxyXG4gICAgfSlcclxuICB9LFxyXG5cclxuICBnZXREeW5hbWljKCkge1xyXG4gICAgY291bnQrK1xyXG4gICAgaWYgKCFpc0JvdHRvbSkge1xyXG4gICAgICBhamF4KCdEeW5hbWljL2dldExpc3QnLCB7IHVpZDogYXBwLmdsb2JhbERhdGEudWlkLCBwYWdlOiBjb3VudCB9KS50aGVuKChyZXM6IGFueSkgPT4ge1xyXG4gICAgICAgIHd4LnN0b3BQdWxsRG93blJlZnJlc2goKVxyXG4gICAgICAgIGlmIChyZXMuZGF0YS5kYXRhLmxlbmd0aCA+IDApIHtcclxuICAgICAgICAgIGZvciAobGV0IGtleSBpbiByZXMuZGF0YS5kYXRhKSB7XHJcbiAgICAgICAgICAgIHJlcy5kYXRhLmRhdGFba2V5XS5jcmVhdGVfdGltZSA9IGZvcm1hdE1zZ1RpbWUocmVzLmRhdGEuZGF0YVtrZXldLmNyZWF0ZV90aW1lICogMTAwMClcclxuICAgICAgICAgICAgbGlzdC5wdXNoKHJlcy5kYXRhLmRhdGFba2V5XSlcclxuICAgICAgICAgIH1cclxuICAgICAgICAgIHRoaXMuc2V0RGF0YSh7XHJcbiAgICAgICAgICAgIGxpc3RcclxuICAgICAgICAgIH0pXHJcbiAgICAgICAgfSBlbHNlIHtcclxuICAgICAgICAgIGlzQm90dG9tID0gdHJ1ZVxyXG4gICAgICAgIH1cclxuICAgICAgfSlcclxuICAgIH1cclxuICB9LFxyXG5cclxuICAvKipcclxuICAgKiDnlJ/lkb3lkajmnJ/lh73mlbAtLeebkeWQrOmhtemdouWKoOi9vVxyXG4gICAqL1xyXG4gIG9uTG9hZCgpIHtcclxuICB9LFxyXG5cclxuICAvKipcclxuICAgKiDnlJ/lkb3lkajmnJ/lh73mlbAtLeebkeWQrOmhtemdouWIneasoea4suafk+WujOaIkFxyXG4gICAqL1xyXG4gIG9uUmVhZHkoKSB7XHJcblxyXG4gIH0sXHJcblxyXG4gIC8qKlxyXG4gICAqIOeUn+WRveWRqOacn+WHveaVsC0t55uR5ZCs6aG16Z2i6ZqQ6JePXHJcbiAgICovXHJcbiAgb25IaWRlKCkge1xyXG4gICAgbGlzdCA9IFtdXHJcbiAgICBjb3VudCA9IDBcclxuICB9LFxyXG5cclxuICAvKipcclxuICAgKiDnlJ/lkb3lkajmnJ/lh73mlbAtLeebkeWQrOmhtemdouWNuOi9vVxyXG4gICAqL1xyXG4gIG9uVW5sb2FkKCkge1xyXG5cclxuICB9LFxyXG5cclxuICAvKipcclxuICAgKiDpobXpnaLnm7jlhbPkuovku7blpITnkIblh73mlbAtLeebkeWQrOeUqOaIt+S4i+aLieWKqOS9nFxyXG4gICAqL1xyXG4gIG9uUHVsbERvd25SZWZyZXNoKCkge1xyXG4gICAgbGlzdCA9IFtdXHJcbiAgICBjb3VudCA9IDBcclxuICAgIHRoaXMuZ2V0RHluYW1pYygpXHJcbiAgfSxcclxuXHJcbiAgLyoqXHJcbiAgICog6aG16Z2i5LiK5ouJ6Kem5bqV5LqL5Lu255qE5aSE55CG5Ye95pWwXHJcbiAgICovXHJcbiAgb25SZWFjaEJvdHRvbSgpIHtcclxuXHJcbiAgICB0aGlzLmdldER5bmFtaWMoKVxyXG4gIH0sXHJcblxyXG4gIC8qKlxyXG4gICAqIOeUqOaIt+eCueWHu+WPs+S4iuinkuWIhuS6q1xyXG4gICAqL1xyXG4gIG9uU2hhcmVBcHBNZXNzYWdlKCkge1xyXG5cclxuICB9XHJcbn0pIl19