"use strict";
Object.defineProperty(exports, "__esModule", { value: true });
var _a = require('../../../utils/util'), ajax = _a.ajax, formatMsgTime = _a.formatMsgTime;
var app = getApp();
var list = [];
var count = 0;
var isBottom = false;
var type;
Page({
    data: {
        list: [],
    },
    onShow: function () {
        if (typeof this.getTabBar === 'function' && this.getTabBar()) {
            this.getTabBar().setData({
                selected: 1
            });
        }
        this.getDynamic();
    },
    goPublish: function () {
        wx.navigateTo({
            url: "/pages/societies/publish/index"
        });
    },
    handle: function (e) {
        list = [];
        this.setData({
            list: list
        });
        count = 0;
        isBottom = false;
        type = e.detail === 0 ? 'focus' : (e.detail === 1 ? '' : 'societies');
        this.getDynamic(type);
        console.log(e.detail, type);
    },
    subscribe: function (e) {
        var _this = this;
        var index = e.currentTarget.dataset.index;
        var data = {
            subscribe: app.globalData.uid,
            be_subscribe: e.currentTarget.dataset.be_subscribe,
            update_time: Date.parse(new Date()) / 1000
        };
        app.globalData.subscribe(data).then(function () {
            _this.data.list[index].fans = true;
            _this.setData({
                list: _this.data.list
            });
        });
    },
    goInfo: function (e) {
        wx.navigateTo({
            url: "/pages/user/info/index?uid=" + e.currentTarget.dataset.uid
        });
    },
    cancelSubscribe: function (e) {
        var _this = this;
        var index = e.currentTarget.dataset.index;
        var data = {
            subscribe: app.globalData.uid,
            be_subscribe: e.currentTarget.dataset.be_subscribe,
        };
        app.globalData.unSubscribe({
            data: data,
            success: function () {
                _this.data.list[index].fans = false;
                _this.setData({
                    list: _this.data.list
                });
            }
        });
    },
    getDynamic: function (type) {
        var _this = this;
        count++;
        if (!isBottom) {
            console.log(type);
            ajax('Dynamic/getList', { uid: app.globalData.uid, page: count, type: type }).then(function (res) {
                wx.stopPullDownRefresh();
                if (res.data.data.length > 0) {
                    for (var key in res.data.data) {
                        res.data.data[key].create_time = formatMsgTime(res.data.data[key].create_time * 1000);
                        list.push(res.data.data[key]);
                    }
                    _this.setData({
                        list: list
                    });
                }
                else {
                    isBottom = true;
                }
            });
        }
    },
    onLoad: function () {
    },
    onReady: function () {
    },
    onHide: function () {
        list = [];
        count = 0;
    },
    onUnload: function () {
    },
    onPullDownRefresh: function () {
        list = [];
        count = 0;
        this.setData({
            list: list
        });
        this.getDynamic(type);
    },
    onReachBottom: function () {
        this.getDynamic(type);
    },
    onShareAppMessage: function () {
    }
});
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiaW5kZXguanMiLCJzb3VyY2VSb290IjoiIiwic291cmNlcyI6WyJpbmRleC50cyJdLCJuYW1lcyI6W10sIm1hcHBpbmdzIjoiOztBQUNNLElBQUEsS0FBMEIsT0FBTyxDQUFDLHFCQUFxQixDQUFDLEVBQXRELElBQUksVUFBQSxFQUFFLGFBQWEsbUJBQW1DLENBQUE7QUFDOUQsSUFBTSxHQUFHLEdBQUcsTUFBTSxFQUFFLENBQUE7QUFDcEIsSUFBSSxJQUFJLEdBQVEsRUFBRSxDQUFBO0FBQ2xCLElBQUksS0FBSyxHQUFHLENBQUMsQ0FBQTtBQUNiLElBQUksUUFBUSxHQUFHLEtBQUssQ0FBQTtBQUNwQixJQUFJLElBQVksQ0FBQTtBQUNoQixJQUFJLENBQUM7SUFDSCxJQUFJLEVBQUU7UUFDSixJQUFJLEVBQUUsRUFBUztLQUNoQjtJQUNELE1BQU0sRUFBRTtRQUNOLElBQUksT0FBTyxJQUFJLENBQUMsU0FBUyxLQUFLLFVBQVUsSUFBSSxJQUFJLENBQUMsU0FBUyxFQUFFLEVBQUU7WUFDNUQsSUFBSSxDQUFDLFNBQVMsRUFBRSxDQUFDLE9BQU8sQ0FBQztnQkFDdkIsUUFBUSxFQUFFLENBQUM7YUFDWixDQUFDLENBQUE7U0FDSDtRQUNELElBQUksQ0FBQyxVQUFVLEVBQUUsQ0FBQTtJQUNuQixDQUFDO0lBRUQsU0FBUztRQUNQLEVBQUUsQ0FBQyxVQUFVLENBQUM7WUFDWixHQUFHLEVBQUUsZ0NBQWdDO1NBQ3RDLENBQUMsQ0FBQTtJQUNKLENBQUM7SUFFRCxNQUFNLEVBQU4sVUFBTyxDQUFNO1FBQ1gsSUFBSSxHQUFHLEVBQUUsQ0FBQTtRQUNULElBQUksQ0FBQyxPQUFPLENBQUM7WUFDWCxJQUFJLE1BQUE7U0FDTCxDQUFDLENBQUE7UUFDRixLQUFLLEdBQUcsQ0FBQyxDQUFBO1FBQ1QsUUFBUSxHQUFHLEtBQUssQ0FBQTtRQUNoQixJQUFJLEdBQUcsQ0FBQyxDQUFDLE1BQU0sS0FBSyxDQUFDLENBQUMsQ0FBQyxDQUFDLE9BQU8sQ0FBQyxDQUFDLENBQUMsQ0FBQyxDQUFDLENBQUMsTUFBTSxLQUFLLENBQUMsQ0FBQyxDQUFDLENBQUMsRUFBRSxDQUFDLENBQUMsQ0FBQyxXQUFXLENBQUMsQ0FBQTtRQUNyRSxJQUFJLENBQUMsVUFBVSxDQUFDLElBQUksQ0FBQyxDQUFBO1FBQ3JCLE9BQU8sQ0FBQyxHQUFHLENBQUMsQ0FBQyxDQUFDLE1BQU0sRUFBRSxJQUFJLENBQUMsQ0FBQTtJQUM3QixDQUFDO0lBTUQsU0FBUyxFQUFULFVBQVUsQ0FBTTtRQUFoQixpQkFhQztRQVpDLElBQUksS0FBSyxHQUFHLENBQUMsQ0FBQyxhQUFhLENBQUMsT0FBTyxDQUFDLEtBQUssQ0FBQTtRQUN6QyxJQUFJLElBQUksR0FBRztZQUNULFNBQVMsRUFBRSxHQUFHLENBQUMsVUFBVSxDQUFDLEdBQUc7WUFDN0IsWUFBWSxFQUFFLENBQUMsQ0FBQyxhQUFhLENBQUMsT0FBTyxDQUFDLFlBQVk7WUFDbEQsV0FBVyxFQUFFLElBQUksQ0FBQyxLQUFLLENBQUUsSUFBSSxJQUFJLEVBQVUsQ0FBQyxHQUFHLElBQUk7U0FDcEQsQ0FBQTtRQUNELEdBQUcsQ0FBQyxVQUFVLENBQUMsU0FBUyxDQUFDLElBQUksQ0FBQyxDQUFDLElBQUksQ0FBQztZQUNsQyxLQUFJLENBQUMsSUFBSSxDQUFDLElBQUksQ0FBQyxLQUFLLENBQUMsQ0FBQyxJQUFJLEdBQUcsSUFBSSxDQUFBO1lBQ2pDLEtBQUksQ0FBQyxPQUFPLENBQUM7Z0JBQ1gsSUFBSSxFQUFFLEtBQUksQ0FBQyxJQUFJLENBQUMsSUFBSTthQUNyQixDQUFDLENBQUE7UUFDSixDQUFDLENBQUMsQ0FBQTtJQUNKLENBQUM7SUFFRCxNQUFNLEVBQU4sVUFBTyxDQUFNO1FBQ1gsRUFBRSxDQUFDLFVBQVUsQ0FBQztZQUNaLEdBQUcsRUFBRSw2QkFBNkIsR0FBRyxDQUFDLENBQUMsYUFBYSxDQUFDLE9BQU8sQ0FBQyxHQUFHO1NBQ2pFLENBQUMsQ0FBQTtJQUNKLENBQUM7SUFNRCxlQUFlLEVBQWYsVUFBZ0IsQ0FBTTtRQUF0QixpQkFjQztRQWJDLElBQUksS0FBSyxHQUFHLENBQUMsQ0FBQyxhQUFhLENBQUMsT0FBTyxDQUFDLEtBQUssQ0FBQTtRQUN6QyxJQUFJLElBQUksR0FBRztZQUNULFNBQVMsRUFBRSxHQUFHLENBQUMsVUFBVSxDQUFDLEdBQUc7WUFDN0IsWUFBWSxFQUFFLENBQUMsQ0FBQyxhQUFhLENBQUMsT0FBTyxDQUFDLFlBQVk7U0FDbkQsQ0FBQTtRQUNELEdBQUcsQ0FBQyxVQUFVLENBQUMsV0FBVyxDQUFDO1lBQ3pCLElBQUksTUFBQTtZQUFFLE9BQU8sRUFBRTtnQkFDYixLQUFJLENBQUMsSUFBSSxDQUFDLElBQUksQ0FBQyxLQUFLLENBQUMsQ0FBQyxJQUFJLEdBQUcsS0FBSyxDQUFBO2dCQUNsQyxLQUFJLENBQUMsT0FBTyxDQUFDO29CQUNYLElBQUksRUFBRSxLQUFJLENBQUMsSUFBSSxDQUFDLElBQUk7aUJBQ3JCLENBQUMsQ0FBQTtZQUNKLENBQUM7U0FDRixDQUFDLENBQUE7SUFDSixDQUFDO0lBRUQsVUFBVSxFQUFWLFVBQVcsSUFBVTtRQUFyQixpQkFtQkM7UUFsQkMsS0FBSyxFQUFFLENBQUE7UUFDUCxJQUFJLENBQUMsUUFBUSxFQUFFO1lBQ2IsT0FBTyxDQUFDLEdBQUcsQ0FBQyxJQUFJLENBQUMsQ0FBQTtZQUNqQixJQUFJLENBQUMsaUJBQWlCLEVBQUUsRUFBRSxHQUFHLEVBQUUsR0FBRyxDQUFDLFVBQVUsQ0FBQyxHQUFHLEVBQUUsSUFBSSxFQUFFLEtBQUssRUFBRSxJQUFJLE1BQUEsRUFBRSxDQUFDLENBQUMsSUFBSSxDQUFDLFVBQUMsR0FBUTtnQkFDcEYsRUFBRSxDQUFDLG1CQUFtQixFQUFFLENBQUE7Z0JBQ3hCLElBQUksR0FBRyxDQUFDLElBQUksQ0FBQyxJQUFJLENBQUMsTUFBTSxHQUFHLENBQUMsRUFBRTtvQkFDNUIsS0FBSyxJQUFJLEdBQUcsSUFBSSxHQUFHLENBQUMsSUFBSSxDQUFDLElBQUksRUFBRTt3QkFDN0IsR0FBRyxDQUFDLElBQUksQ0FBQyxJQUFJLENBQUMsR0FBRyxDQUFDLENBQUMsV0FBVyxHQUFHLGFBQWEsQ0FBQyxHQUFHLENBQUMsSUFBSSxDQUFDLElBQUksQ0FBQyxHQUFHLENBQUMsQ0FBQyxXQUFXLEdBQUcsSUFBSSxDQUFDLENBQUE7d0JBQ3JGLElBQUksQ0FBQyxJQUFJLENBQUMsR0FBRyxDQUFDLElBQUksQ0FBQyxJQUFJLENBQUMsR0FBRyxDQUFDLENBQUMsQ0FBQTtxQkFDOUI7b0JBQ0QsS0FBSSxDQUFDLE9BQU8sQ0FBQzt3QkFDWCxJQUFJLE1BQUE7cUJBQ0wsQ0FBQyxDQUFBO2lCQUNIO3FCQUFNO29CQUNMLFFBQVEsR0FBRyxJQUFJLENBQUE7aUJBQ2hCO1lBQ0gsQ0FBQyxDQUFDLENBQUE7U0FDSDtJQUNILENBQUM7SUFLRCxNQUFNO0lBQ04sQ0FBQztJQUtELE9BQU87SUFFUCxDQUFDO0lBS0QsTUFBTTtRQUNKLElBQUksR0FBRyxFQUFFLENBQUE7UUFDVCxLQUFLLEdBQUcsQ0FBQyxDQUFBO0lBQ1gsQ0FBQztJQUtELFFBQVE7SUFFUixDQUFDO0lBS0QsaUJBQWlCO1FBQ2YsSUFBSSxHQUFHLEVBQUUsQ0FBQTtRQUNULEtBQUssR0FBRyxDQUFDLENBQUE7UUFDVCxJQUFJLENBQUMsT0FBTyxDQUFDO1lBQ1gsSUFBSSxNQUFBO1NBQ0wsQ0FBQyxDQUFBO1FBQ0YsSUFBSSxDQUFDLFVBQVUsQ0FBQyxJQUFJLENBQUMsQ0FBQTtJQUN2QixDQUFDO0lBS0QsYUFBYTtRQUVYLElBQUksQ0FBQyxVQUFVLENBQUMsSUFBSSxDQUFDLENBQUE7SUFDdkIsQ0FBQztJQUtELGlCQUFpQjtJQUVqQixDQUFDO0NBQ0YsQ0FBQyxDQUFBIiwic291cmNlc0NvbnRlbnQiOlsiZXhwb3J0IHsgfVxyXG5jb25zdCB7IGFqYXgsIGZvcm1hdE1zZ1RpbWUgfSA9IHJlcXVpcmUoJy4uLy4uLy4uL3V0aWxzL3V0aWwnKVxyXG5jb25zdCBhcHAgPSBnZXRBcHAoKVxyXG5sZXQgbGlzdDogYW55ID0gW11cclxubGV0IGNvdW50ID0gMFxyXG5sZXQgaXNCb3R0b20gPSBmYWxzZVxyXG5sZXQgdHlwZTogc3RyaW5nXHJcblBhZ2Uoe1xyXG4gIGRhdGE6IHtcclxuICAgIGxpc3Q6IFtdIGFzIGFueSxcclxuICB9LFxyXG4gIG9uU2hvdzogZnVuY3Rpb24gKCkge1xyXG4gICAgaWYgKHR5cGVvZiB0aGlzLmdldFRhYkJhciA9PT0gJ2Z1bmN0aW9uJyAmJiB0aGlzLmdldFRhYkJhcigpKSB7XHJcbiAgICAgIHRoaXMuZ2V0VGFiQmFyKCkuc2V0RGF0YSh7XHJcbiAgICAgICAgc2VsZWN0ZWQ6IDFcclxuICAgICAgfSlcclxuICAgIH1cclxuICAgIHRoaXMuZ2V0RHluYW1pYygpXHJcbiAgfSxcclxuXHJcbiAgZ29QdWJsaXNoKCkge1xyXG4gICAgd3gubmF2aWdhdGVUbyh7XHJcbiAgICAgIHVybDogXCIvcGFnZXMvc29jaWV0aWVzL3B1Ymxpc2gvaW5kZXhcIlxyXG4gICAgfSlcclxuICB9LFxyXG5cclxuICBoYW5kbGUoZTogYW55KSB7XHJcbiAgICBsaXN0ID0gW11cclxuICAgIHRoaXMuc2V0RGF0YSh7XHJcbiAgICAgIGxpc3RcclxuICAgIH0pXHJcbiAgICBjb3VudCA9IDBcclxuICAgIGlzQm90dG9tID0gZmFsc2VcclxuICAgIHR5cGUgPSBlLmRldGFpbCA9PT0gMCA/ICdmb2N1cycgOiAoZS5kZXRhaWwgPT09IDEgPyAnJyA6ICdzb2NpZXRpZXMnKVxyXG4gICAgdGhpcy5nZXREeW5hbWljKHR5cGUpXHJcbiAgICBjb25zb2xlLmxvZyhlLmRldGFpbCwgdHlwZSlcclxuICB9LFxyXG5cclxuICAvKipcclxuICAgICAqIOWFs+azqFxyXG4gICAgICogQHBhcmFtIGUgXHJcbiAgICAgKi9cclxuICBzdWJzY3JpYmUoZTogYW55KSB7XHJcbiAgICBsZXQgaW5kZXggPSBlLmN1cnJlbnRUYXJnZXQuZGF0YXNldC5pbmRleFxyXG4gICAgbGV0IGRhdGEgPSB7XHJcbiAgICAgIHN1YnNjcmliZTogYXBwLmdsb2JhbERhdGEudWlkLFxyXG4gICAgICBiZV9zdWJzY3JpYmU6IGUuY3VycmVudFRhcmdldC5kYXRhc2V0LmJlX3N1YnNjcmliZSxcclxuICAgICAgdXBkYXRlX3RpbWU6IERhdGUucGFyc2UoKG5ldyBEYXRlKCkgYXMgYW55KSkgLyAxMDAwXHJcbiAgICB9XHJcbiAgICBhcHAuZ2xvYmFsRGF0YS5zdWJzY3JpYmUoZGF0YSkudGhlbigoKSA9PiB7XHJcbiAgICAgIHRoaXMuZGF0YS5saXN0W2luZGV4XS5mYW5zID0gdHJ1ZVxyXG4gICAgICB0aGlzLnNldERhdGEoe1xyXG4gICAgICAgIGxpc3Q6IHRoaXMuZGF0YS5saXN0XHJcbiAgICAgIH0pXHJcbiAgICB9KVxyXG4gIH0sXHJcblxyXG4gIGdvSW5mbyhlOiBhbnkpIHtcclxuICAgIHd4Lm5hdmlnYXRlVG8oe1xyXG4gICAgICB1cmw6IFwiL3BhZ2VzL3VzZXIvaW5mby9pbmRleD91aWQ9XCIgKyBlLmN1cnJlbnRUYXJnZXQuZGF0YXNldC51aWRcclxuICAgIH0pXHJcbiAgfSxcclxuXHJcbiAgLyoqXHJcbiAgICAgKiDlj5bmtojlhbPms6hcclxuICAgICAqIEBwYXJhbSBlIFxyXG4gICAgICovXHJcbiAgY2FuY2VsU3Vic2NyaWJlKGU6IGFueSkge1xyXG4gICAgbGV0IGluZGV4ID0gZS5jdXJyZW50VGFyZ2V0LmRhdGFzZXQuaW5kZXhcclxuICAgIGxldCBkYXRhID0ge1xyXG4gICAgICBzdWJzY3JpYmU6IGFwcC5nbG9iYWxEYXRhLnVpZCxcclxuICAgICAgYmVfc3Vic2NyaWJlOiBlLmN1cnJlbnRUYXJnZXQuZGF0YXNldC5iZV9zdWJzY3JpYmUsXHJcbiAgICB9XHJcbiAgICBhcHAuZ2xvYmFsRGF0YS51blN1YnNjcmliZSh7XHJcbiAgICAgIGRhdGEsIHN1Y2Nlc3M6ICgpID0+IHtcclxuICAgICAgICB0aGlzLmRhdGEubGlzdFtpbmRleF0uZmFucyA9IGZhbHNlXHJcbiAgICAgICAgdGhpcy5zZXREYXRhKHtcclxuICAgICAgICAgIGxpc3Q6IHRoaXMuZGF0YS5saXN0XHJcbiAgICAgICAgfSlcclxuICAgICAgfVxyXG4gICAgfSlcclxuICB9LFxyXG5cclxuICBnZXREeW5hbWljKHR5cGU/OiBhbnkpIHtcclxuICAgIGNvdW50KytcclxuICAgIGlmICghaXNCb3R0b20pIHtcclxuICAgICAgY29uc29sZS5sb2codHlwZSlcclxuICAgICAgYWpheCgnRHluYW1pYy9nZXRMaXN0JywgeyB1aWQ6IGFwcC5nbG9iYWxEYXRhLnVpZCwgcGFnZTogY291bnQsIHR5cGUgfSkudGhlbigocmVzOiBhbnkpID0+IHtcclxuICAgICAgICB3eC5zdG9wUHVsbERvd25SZWZyZXNoKClcclxuICAgICAgICBpZiAocmVzLmRhdGEuZGF0YS5sZW5ndGggPiAwKSB7XHJcbiAgICAgICAgICBmb3IgKGxldCBrZXkgaW4gcmVzLmRhdGEuZGF0YSkge1xyXG4gICAgICAgICAgICByZXMuZGF0YS5kYXRhW2tleV0uY3JlYXRlX3RpbWUgPSBmb3JtYXRNc2dUaW1lKHJlcy5kYXRhLmRhdGFba2V5XS5jcmVhdGVfdGltZSAqIDEwMDApXHJcbiAgICAgICAgICAgIGxpc3QucHVzaChyZXMuZGF0YS5kYXRhW2tleV0pXHJcbiAgICAgICAgICB9XHJcbiAgICAgICAgICB0aGlzLnNldERhdGEoe1xyXG4gICAgICAgICAgICBsaXN0XHJcbiAgICAgICAgICB9KVxyXG4gICAgICAgIH0gZWxzZSB7XHJcbiAgICAgICAgICBpc0JvdHRvbSA9IHRydWVcclxuICAgICAgICB9XHJcbiAgICAgIH0pXHJcbiAgICB9XHJcbiAgfSxcclxuXHJcbiAgLyoqXHJcbiAgICog55Sf5ZG95ZGo5pyf5Ye95pWwLS3nm5HlkKzpobXpnaLliqDovb1cclxuICAgKi9cclxuICBvbkxvYWQoKSB7XHJcbiAgfSxcclxuXHJcbiAgLyoqXHJcbiAgICog55Sf5ZG95ZGo5pyf5Ye95pWwLS3nm5HlkKzpobXpnaLliJ3mrKHmuLLmn5PlrozmiJBcclxuICAgKi9cclxuICBvblJlYWR5KCkge1xyXG5cclxuICB9LFxyXG5cclxuICAvKipcclxuICAgKiDnlJ/lkb3lkajmnJ/lh73mlbAtLeebkeWQrOmhtemdoumakOiXj1xyXG4gICAqL1xyXG4gIG9uSGlkZSgpIHtcclxuICAgIGxpc3QgPSBbXVxyXG4gICAgY291bnQgPSAwXHJcbiAgfSxcclxuXHJcbiAgLyoqXHJcbiAgICog55Sf5ZG95ZGo5pyf5Ye95pWwLS3nm5HlkKzpobXpnaLljbjovb1cclxuICAgKi9cclxuICBvblVubG9hZCgpIHtcclxuXHJcbiAgfSxcclxuXHJcbiAgLyoqXHJcbiAgICog6aG16Z2i55u45YWz5LqL5Lu25aSE55CG5Ye95pWwLS3nm5HlkKznlKjmiLfkuIvmi4nliqjkvZxcclxuICAgKi9cclxuICBvblB1bGxEb3duUmVmcmVzaCgpIHtcclxuICAgIGxpc3QgPSBbXVxyXG4gICAgY291bnQgPSAwXHJcbiAgICB0aGlzLnNldERhdGEoe1xyXG4gICAgICBsaXN0XHJcbiAgICB9KVxyXG4gICAgdGhpcy5nZXREeW5hbWljKHR5cGUpXHJcbiAgfSxcclxuXHJcbiAgLyoqXHJcbiAgICog6aG16Z2i5LiK5ouJ6Kem5bqV5LqL5Lu255qE5aSE55CG5Ye95pWwXHJcbiAgICovXHJcbiAgb25SZWFjaEJvdHRvbSgpIHtcclxuXHJcbiAgICB0aGlzLmdldER5bmFtaWModHlwZSlcclxuICB9LFxyXG5cclxuICAvKipcclxuICAgKiDnlKjmiLfngrnlh7vlj7PkuIrop5LliIbkuqtcclxuICAgKi9cclxuICBvblNoYXJlQXBwTWVzc2FnZSgpIHtcclxuXHJcbiAgfVxyXG59KSJdfQ==